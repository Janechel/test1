# 前置说明
- 在内存表的部分参数采用高字节与低字节的值域，这部分参数在内存表的地址是**低字节在前、高字节在后**，负数以原码的补码形式表达。
- 指令包：Flash区域中的数据修改前若**未打开Flash开关，掉电不保存**。
- 应答包：不同舵机应答的信息可能不同。
    - 如果舵机指令包处理过程中没有出现错误，应答包的状态值为0x00。
    - 如果出现特定的错误，对应的Bit位设置为1，并返回不带参数的应答包。当同时出现多个错误，对应的Bit位均置1，即**数值相加**。

|Bit位|状态值|类型|说明|
|---|---|---|---|
|Bit0|0x01|电压报错|舵机的输入电压不在内存表设定的电压限制范围内|
|Bit1|0x02|角度报错|舵机的目标位置不在内存表设定的位置限制范围内|
|Bit2|0x04|过热报错|舵机内部的温度超过内存表内限定的最高温度|
|Bit3|0x08|范围报错|指令包的长度超过规定的长度|
|Bit4|0x10|校验报错|指令包的校验和解析不正确|
|Bit5|0x20|堵转报错|舵机因过流或过载等发生堵转|
|Bit6|0x40|解析报错|指令包没按协议规定的格式导致解析错误|
|Bit7|0x80|——|——|

- 以下关于数据包的解析均**基于实际测试结果**，仅供参考！
-----------------------------------------------------------------------------------------------------------------------------------------------------
# 示例解析
-----------------------------------------------------------------------------------------------------------------------------------------------------
## 查询指令
#### 查询ID1舵机的型号编号
- 指令包：使用ID1，Ping指令直接查询
- 应答包：查询的参数为0x4E 0x4F (0x4F4E)，说明该ID1舵机的型号编号为20302。
-------------------------------------------------------------------------------
## 读指令
#### 读取ID1舵机的固件版本号
- 指令包：使用ID1，从内存表的固件版本号地址0x02开始，读取1个字节的数据。
    - 注意：地址十六进制，读取字节十进制
- 应答包：读出的参数为0x09，说明该ID1舵机的固件版本号为9。
    - 注意：参数十六进制，说明十进制

#### 读取ID1舵机的出厂编号
- 指令包：使用ID1，从内存表的出厂编号地址0x03开始，依次读取4个字节的数据。
- 应答包：读出的参数为0x01 0x00 0x00 0x00(0x0000000001)，说明该ID1舵机的出厂编号为1。

#### 读取ID1舵机的波特率编号
- 指令包：使用ID1，从内存表的波特率编号地址0x08开始，读取1个字节的数据。
- 应答包：读出的参数为0x07，说明ID1舵机的波特率编号为7，查表可知串行通信速度为1Mbps。
    - 注意：默认波特率为1Mbps，内存表对应的值为7。

#### 读取ID1舵机的应答延迟时间
- 应答包：读出的参数为0xFA(250)，说明ID1舵机的应答延迟时间为500us。
    - 注意：带单位参数，需要换算成具体十进制的值。

#### 读取ID1舵机的状态返回级别
- 应答包：读出的参数为0x02，说明ID1舵机的状态返回级别为2，查表可知为应答所有指令。
    - 注意：状态返回级别的值0、1、2，分别代表仅应答Ping指令、应答Ping指令和读指令、应答所有指令。

#### 读取ID1舵机的位置限制
- 指令包：使用ID1，从内存表的最小位置限制地址0x0B开始，依次读取4个字节的数据。
- 应答包：读出的参数为0x00 0x00 0xB8 0x0B，即最小位置限制为0x0000(0)、最大位置限制为0x0BB8(3000)，说明ID1舵机的位置限制为0~3000°。

#### 读取ID1舵机的电压限制
- 应答包：读出的参数为0x5A 0x21，即电压上限为0x5A(90)，电压下限为0x21(33)，说明ID1舵机的电压限制为3.3V~9V。

#### 读取ID1舵机的电流上限
- 应答包：以EM-2030为例，读出的参数为0x90 0x01，即0x0190(400)，说明ID1舵机的电流上限为400mA。
    - 注意：不同舵机型号，电流范围和默认值不同，需要具体到型号举例说明

#### 读取ID1舵机的位置控制PID增益
- 应答包：读出的参数为0x70 0x17 0x00 0x00 0x...，说明ID1舵机的位置控制P增益为0x1770(6000)、I增益...(0)、D增益...(150)。

#### 读取ID1舵机的LED报警条件
- 应答包：读出的参数为0x24，说明ID1舵机的LED报警条件为开启堵转报错和过热报错
    - 注意：LED报警条件的值0x01、0x02、0x04...，分别代表开启电压报错、角度报错...。参数值之间可以叠加，代表开启多类报错。

#### 读取ID1舵机的卸载保护条件
- 应答包：读出的参数为0x24，说明ID1舵机的卸载保护条件为开启堵转报错和过热报错
    - 注意：开机保护条件的值0x01、0x02、0x04...，分别代表开启电压报错、角度报错...。参数值之间可以叠加，代表开启多类报错。

#### 读取ID1舵机的控制模式
- 应答包：读出的参数为0x01，说明ID1舵机的控制模式为1，查表可知为控速模式
    - 注意：控制模式的值0、1、2、3，分别代表...

#### 读取ID1舵机的Flash开关状态
- 应答包：读出的参数为0x00，说明ID1舵机的Flash开关状态为关闭。
    - 注意：Flash开关状态的值0、1，分别代表关闭、打开。

#### 读取ID1舵机的LED开关状态
- 注意：LED开关状态的值0、1，分别代表关闭、打开。

#### 读取ID1舵机的扭矩开关状态
- 注意：扭矩开关状态的值0、1、2，分别代表关闭、打开、刹车模式。

#### 读取ID1舵机的控速目标位置、速度和加减速度
- 应答包：以EM-2030为例，读出的参数为0xDC 0x05 0x20 0x1C 0x96 0x96，即控速目标位置0x05DC(1500)、控速目标速度为0x1C20(7200)、控速目标加速度为0x96(150)、控速目标减速度为0x96(150)，说明ID1舵机的控速目标位置为150°、控速目标速度为720°/s、控速目标加速度为7500°/s²、控速目标减速度为7500°/s²。

#### 读取ID1舵机的控时目标加速度等级
- 应答包：读出的参数为0x00，说明ID1舵机的控时目标加速度等级为1，查表可知为没有加速度。
    - 注意：控时目标加速度等级的值0、1、2、3、4、5，代表加速度等级数值越大，加减速度越快。

#### 读取ID1舵机的当前位置
- 指令包：使用ID1，从内存表的当前位置地址0x4A开始，依次读取2个字节的数据。
- 应答包：读出的参数为0xDC 0x05，即0x05DC(1500)，说明该ID1舵机的当前位置为150°。

#### 读取ID1舵机的当前位置和当前电流
- 指令包：使用ID1，从内存表的当前位置地址0x4A开始，依次读取4个字节的数据。
- 应答包：读出的参数为0xDC 0x05  0x90 0x01，即当前位置0x05DC(1500)、当前电流0x0190(400)，说明该ID1舵机的当前位置为150°、当前电流为400mA。
---------------------------------------------------------------------------
## 写指令
#### 将ID1舵机的ID编号修改为2
- 指令包：使用ID1，从内存表的舵机ID地址0x07开始，写入数据0x02。
- 应答包：因为ID编号已修改为2，所以不会返回状态数据包。可以通过Ping指令查询ID2舵机，判断是否修改成功。

#### 将未知ID舵机的ID编号修改为1
- 指令包：使用广播ID，从内存表的舵机ID地址0x07开始，写入数据0x01。
- 应答包：因为使用广播 ID(0xFE)发送指令，所以不会返回状态数据包。可以通过Ping指令查询ID1舵机，判断是否修改成功。

#### 将ID1舵机的波特率修改为9600
- 指令包：使用ID1，从内存表的应答延迟时间地址0x08开始，写入数据0x01(9600对应编号1)。
- 应答包：因为波特率编号已修改为1，所以不会返回状态数据包。可以通过重新选择波特率9600并完成设备连接，然后再通过Ping指令查询ID1舵机，判断是否修改成功。

#### 将ID1舵机的应答延迟时间修改为500us
- 指令包：使用ID1，从内存表的应答延迟时间地址0x09开始，写入数据0xFA(250)。
- 应答包：可以通过读取舵机的应答延迟时间，判断是否修改成功。

#### 将ID1舵机的状态返回级别修改为仅应答Ping指令
- 指令包：使用ID1，从内存表的状态返回级别地址0x0A开始，写入数据0x00。
- 应答包：因为状态返回级别已修改为仅应答Ping指令，所以不会返回状态数据包。可以通过发送读指令，判断是否修改成功。若读指令不响应，说明修改成功。

#### 将舵机ID1的位置限制修改为100°~150°
- 指令包：使用ID1，从内存表的最小位置限制地址0x0B开始，依次写入数据0xE8 0x03 0xDC 0x05(1000 1500)。
- 应答包：可以通过读取舵机的位置限制，判断是否修改成功。
    - 注意：已修改舵机位置限制，目标位置(包括控速目标位置和控时目标位置)都会被强制设定在位置限制的范围内，当超过设置的最大位置限制或者低于设置的最小位置限制，舵机当前状态的角度报警位(Bit位:0x02)会置1。如果LED报警条件有开启角度报警，则舵机会将LED开关循环置1和0，即LED灯闪烁；如果卸载保护条件有开启角度保护，则舵机会将扭矩开关置0，即关闭扭矩。

#### 将ID1舵机的温度上限修改为65℃
- 注意：已修改温度上限，当舵机内部的当前温度超过温度上限时，舵机当前状态的温度报警位(Bit位:0x04)会置1。如果LED报警条件有开启过热报警(默认开启)，则舵机会将LED开关循环置1和0，即LED灯闪烁；如果卸载保护条件有开启过热保护(默认开启)，则舵机会将扭矩开关置0，即关闭扭矩。

#### 将ID1舵机的电压限制修改为3.5V~8.4V
- 注意：已修改电压限制，当舵机的当前输入电压超过设置的电压上限或者低于设置的电压下限，舵机当前状态的电压报警位(Bit位:0x01)会置1。如果LED报警条件有开启电压报警，则舵机会将LED开关循环置1和0，即LED灯闪烁；如果卸载保护条件有开启电压保护，则舵机会将扭矩开关置0，即关闭扭矩。

#### 将ID1舵机的PWM上限修改为90%
- 注意：高电平的时间占整个周期比例90%，舵机输出的PWM不是100%。降低舵机输出的PWM会降低扭矩和速度。

#### 将ID1舵机的电流上限修改为900mA
- 注意：已修改电流上限，当舵机的当前电流超过设置的电流上限，并且持续时间大于所设定的电流保护时间，舵机当前状态的堵转报警位(Bit位:0x20)会置1。如果LED报警条件有开启堵转报警(默认开启)，则舵机会将LED开关循环置1和0，即LED灯闪烁；如果卸载保护条件有开启堵转保护(默认开启)，则舵机会将扭矩开关置0，即关闭扭矩。

#### 将ID1舵机的电流保护时间修改为500ms
- 注意：已修改电流保护时间，当舵机的当前电流超过设置的电流上限，并且持续时间大于所设定的电流保护时间，舵机当前状态的堵转报警位(Bit位:0x20)会置1。如果LED报警条件有开启堵转报警，则舵机会将LED开关循环置1和0，即LED灯闪烁；如果卸载保护条件有开启堵转保护，则舵机会将扭矩开关置0，即关闭扭矩。

#### 将ID1舵机的正转死区修改为0.2°
- 注意：当舵机在距离目标位置顺时针方向的0.2°内，电机不会输出扭矩。

#### 将ID1舵机的PWM叠加值修改为20%
- 提示：叠加值参数出厂默认根据电机特性做匹配，一般用于弥补舵机的控制死区或克服静摩擦力。
    - 注意：可以观察到单一PWM叠加值增加，使得电机的转速变慢，同时伴随抖动。

#### 将ID1舵机的位置控制P增益修改为5500
- 提示：PID参数之间会相互影响，过度调整可能导致新的问题，因此需要谨慎调整。
- 应答包：可以观察到单一P值增加，使控制系统对误差更敏感，响应速度更快，但过大可能引起过冲和震荡。

#### 将ID1舵机的位置控制I增益修改为100
- 提示：PID参数之间会相互影响，过度调整可能导致新的问题，因此需要谨慎调整。
- 应答包：可以观察到单一I值增加，减小系统稳态误差，使系统更精确，但过大可能导致系统不稳定。

#### 将ID1舵机的位置控制D增益修改为250
- 提示：PID参数之间会相互影响，过度调整可能导致新的问题，因此需要谨慎调整。
- 应答包：可以观察到单一D值增加，抑制响应速度过快和过度振荡，使系统更平滑，但过大可能导致抖动和不稳定。

#### 将ID1舵机的控制模式修改为控时模式
- 提示：切换ID1舵机控制模式前，请先给ID1舵机重上电或关闭扭矩开关。同一控制模式下，设定舵机的不同运动，只需设置一次控制模式。

#### 将ID1舵机的Flash开关状态修改为打开
- 指令包：使用ID1，从内存表的Flash开关地址0x2E开始，写入数据0x01。
- 应答包：可以通过读取舵机的Flash开关状态，判断是否修改成功。

#### 将ID1舵机的扭矩开关状态修改为打开
- 注意：操作扭矩开关时，会清空舵机的当前状态标志位，比如当发生电流过大触发堵转保护时，此时舵机扭矩为关闭状态，往目标位置写值舵机也不会响应。
- 警告：如果要强行让舵机重新工作，通过操作扭矩开关以清除舵机堵转保护的标志位，但有一定风险，请确保上层控制做好相应保护如减轻负重，再做此操作。

#### 将ID1舵机的目标PWM修改为-50%
- 提示：使用PWM输出控制模式让舵机运动时，必须确保控制模式为3，且打开扭矩开关。
- 指令包：使用ID1，从内存表的目标PWM地址0x31开始，依次写入数据...（负数以原码的补码形式表达）。
- 应答包：可以通过读取舵机的目标PWM，或观察舵机是否以50%的目标PWM输出逆时针转动，判断是否修改成功。

#### 将ID1舵机的目标电流修改为-100mA
- 提示：使用电流控制模式让舵机运动时，必须确保控制模式为2，且打开扭矩开关。
- 应答包：可以通过读取舵机的目标电流，或观察舵机是否以100mA的目标电流逆时针转动，判断是否修改成功。
- 补充说明：在位置控制（包含控时和控速）模式下，目标电流是用来限制舵机的最高输出电流，电流越小时舵机的锁舵力越小，此时目标电流没有正负。该值配置过高可能导致打滑，过低可能导致过冲。

#### 将ID1舵机的控速目标位置修改为150°
- 提示：使用控速模式让舵机运动时，必须确保控制模式为1。往目标位置地址写入数值时，会自动将扭矩开关置1，即打开扭矩。
- 指令包：使用ID1，从内存表的控速目标位置地址0x35开始，依次写入数据0xDC,0x05。
- 应答包：可以通过读取舵机的控速目标位置，或观察舵机是否运动到中位，判断是否修改成功。
    - 注意：当当前位置与目标位置相同时，舵机将不会出现运动。

#### 将ID1舵机的控时目标位置和运行时间，分别修改为300°、500ms
- 提示：使用控时模式让舵机运动时，必须确保控制模式为0。往目标位置地址写入数值时，会自动将扭矩开关置1，即打开扭矩。
- 指令包：使用ID1，从内存表的控时目标位置地址0x3C开始，依次写入数据0x...
- 应答包：可以通过读取舵机的控时目标位置和运行时间，或观察舵机是否以500ms运动到300°位置，判断是否修改成功。
    - 注意：当当前位置与目标位置相同时，舵机将不会出现运动。
---------------------------------------------------------------------------
## 同步写指令
#### 将ID1、ID2舵机的控速目标位置，分别修改为150°中位、0°位置
- 提示：使用控速模式让舵机运动时，必须确保控制模式为1。往目标位置地址写入数值时，会自动将扭矩开关置1，即打开扭矩。
- 指令包：使用广播ID，从内存表的控速目标位置地址0x35开始，同步写入2个字节，ID1依次写入数据0xDC,0x05，ID2依次写入数据0x00,0x00。
- 应答包：因为使用广播 ID(0xFE)发送指令，所以不会返回状态数据包。可以通过读取各舵机的控速目标位置，或观察各舵机是否运动到相应位置，判断是否修改成功。
    - 注意：当当前位置与目标位置相同时，舵机将不会出现运动。

#### 将ID1、ID2舵机的控时目标位置和运行时间，分别修改为150°中位和1s、0°位置和500ms
- 提示：使用控时模式让舵机运动时，必须确保控制模式为0。往目标位置地址写入数值时，会自动将扭矩开关置1，即打开扭矩。
- 指令包：使用广播ID，从内存表的控时目标位置地址0x3C开始，同步写入4个字节，ID1依次写入数据0xDC,0x05,0xE8,0x03，ID2依次写入数据0x00,0x00,0xF4,0x01。
- 应答包：因为使用广播 ID(0xFE)发送指令，所以不会返回状态数据包。可以通过读取各舵机的控时目标位置，或观察各舵机是否以设定时间运动到相应位置，判断是否修改成功。
    - 注意：当当前位置与目标位置相同时，舵机将不会出现运动。
---------------------------------------------------------------------------
## 恢复出厂设置指令
#### 恢复舵机的出厂设置
- 提示：此操作将会重置包括波特率、舵机ID、偏移值等一切参数。
- 指令包：使用ID1，恢复出厂设置指令，参数0xDF 0xDF解锁该功能。
- 应答包：该操作执行后舵机将重启。可以通过Ping指令或读指令，判断所有数据是否都恢复。
---------------------------------------------------------------------------
## 恢复参数设置指令
#### 重置舵机的参数
- 提示：此操作会保留舵机原有的波特率、舵机ID、偏移值等信息。
- 指令包：使用ID1，参数重置指令，参数0xDF 0xDF解锁该功能
- 应答包：该操作执行后舵机将重启。可以通过读指令，判断除波特率、舵机ID和偏移值外，其他数据是否都重置。
---------------------------------------------------------------------------
## 校准偏移值指令
#### 校正舵机的中位
- 警告：一般出厂都有做校正，该功能如果不按照规定步骤操作或多次连续校正，可能造成舵机目标位置偏差过多，进入死区范围导致工作不正常，请谨慎使用。发生该情况后可以通过恢复出厂命令进行修复。
- 提示：舵盘上150°位置有刻度线，跟外壳上的刻度线对齐时为150°中间位置。
- 指令包：使用ID1，校正偏移值指令，参数0xDF 0xDF解锁该功能。
- 应答包：可以通过读取舵机的当前位置是否接近150°，判断是否修改成功。
---------------------------------------------------------------------------
## 重启指令
#### 重启舵机
- 指令包：使用ID1，重启指令，参数0xDF 0xDF解锁该功能。
- 应答包：因为收到该指令后舵机将立即重启，所以不会返回状态数据包。可以通过观察舵机LED灯是否有闪烁一次，判断是否重启成功。
-----------------------------------------------------------------------------------------------------------------------------------------------------
# 演示解析
-----------------------------------------------------------------------------------------------------------------------------------------------------
## 基于速度的位置控制模式

#### 让ID1舵机运动到150°中位。
**操作步骤：**
1. 扭矩开关写"0"，即关闭扭矩。
2. 控制模式写"1"，即切换为控速模式（同一控制模式下，只需设置一次）。
3. 设定控速目标位置，即ID1舵机会以设定的方式运动。

**实现步骤：**
1. 将ID1舵机的扭矩开关状态修改为关闭。
    - 指令包：使用ID1，从内存表的扭矩开关地址0x30开始，写入数据0x00。
    - 应答包：可以通过读取舵机的扭矩开关状态，判断是否修改成功。
2. 将ID1舵机的控制模式修改为控速模式。
    - 指令包：使用ID1，从内存表的控制模式地址0x23开始，写入数据0x01。
    - 应答包：可以通过读取舵机的控制模式，判断是否修改成功。
3. 将ID1舵机的控速目标位置修改为150°。
    - 指令包：使用ID1，从内存表的控速目标位置地址0x35开始，依次写入数据0xDC,0x05。
        - 注意：往目标位置地址写入数值时，会自动将扭矩开关置1，即打开扭矩。
    - 应答包：可以通过读取舵机的控速目标位置，或观察舵机是否运动到中位，判断是否修改成功。
        - 注意：当当前位置与目标位置相同时，舵机将不会出现运动。

#### 让ID1舵机以360°/s的控速目标速度、500°/s²的控速目标加速度、50°/s²的控速目标减速度运动到0°位置。
**操作步骤：**
1. 扭矩开关写"0"，即关闭扭矩。
2. 控制模式写"1"，即切换为控速模式（同一控制模式下，只需设置一次）。
3. 设定控速参数，即ID1舵机会以设定的方式运动。

**实现步骤：**
1. 将ID1舵机的扭矩开关状态修改为关闭。
2. 将ID1舵机的控制模式修改为控速模式。
3. 将ID1舵机的控速目标位置、控速目标速度、控速目标加速度和控速目标减速度，分别修改为0°位置、360°/s、500°/s²和50°/s²。
----------------------------------------------------------------------------
## 基于时间的位置控制模式

#### 让ID1舵机以500ms运动到300°位置。
**操作步骤：**
1. 扭矩开关写"0"，即关闭扭矩。
2. 控制模式写"0"，即切换为控时模式（同一控制模式下，只需设置一次）。
3. 设定控时目标位置和运行时间，即ID1舵机会以设定的方式运动。

**实现步骤：**
1. 将ID1舵机的扭矩开关状态修改为关闭。
2. 将ID1舵机的控制模式修改为控时模式。
3. 将ID1舵机的控时目标位置和运行时间，分别修改为300°、500ms。

#### 让ID1舵机以1s匀速运动到0°位置。
**操作步骤：**
1. 扭矩开关写"0"，即关闭扭矩。
2. 控制模式写"1"，即切换为控速模式（同一控制模式下，只需设置一次）。
3. 设定控时参数，即ID1舵机会以设定的方式运动。

**实现步骤：**
1. 将ID1舵机的扭矩开关状态修改为关闭。
2. 将ID1舵机的控制模式修改为控速模式。
3. 将ID1舵机的控时目标加速度等级、位置和运行时间，分别修改为0、300°、1s。
        - 注意：控时目标加速度等级默认值0，即没有加速度（匀速）；1~5加速度等级数值越大，加减速度越快。
------------------------------------------------------------------------------
## PWM控制模式
#### 让ID舵机以50%的PWM输出逆时针转动。
**操作步骤：**
1. 扭矩开关写"0"，即关闭扭矩。
2. 控制模式写"3"，即切换为PWM输出控制模式。
3. 扭矩开关写"1"，即打开扭矩。
4. 设定目标PWM，即ID1舵机会以设定的方式运动。

**实现步骤：**
1. 将ID1舵机的扭矩开关状态修改为关闭。
    - 指令包：使用ID1，从内存表的扭矩开关地址0x30开始，写入数据0x00。
    - 应答包：可以通过读取舵机的扭矩开关状态，判断是否修改成功。
2. 将ID1舵机的控制模式修改为PWM输出控制模式。
    - 指令包：使用ID1，从内存表的控制模式地址0x23开始，写入数据0x03。
    - 应答包：可以通过读取舵机的控制模式，判断是否修改成功。
3. 将ID1舵机的扭矩开关状态修改为打开。
    - 指令包：使用ID1，从内存表的扭矩开关地址0x30开始，写入数据0x01。
    - 应答包：可以通过读取舵机的扭矩开关状态，判断是否修改成功。
4. 将ID1舵机的目标PWM修改为-50%。
    - 指令包：使用ID1，从内存表的目标PWM地址0x31开始，依次写入数据...。
        - 注意：负数以原码的补码形式表达。
    - 应答包：可以通过读取舵机的目标PWM，或观察舵机是否以50%的目标PWM输出逆时针转动，判断是否修改成功。
------------------------------------------------------------------------------
## 电流控制模式
#### 让ID1舵机以100mA的目标电流顺时针转动。
**操作步骤：**
1. 扭矩开关写"0"，即关闭扭矩。
2. 控制模式写"2"，即切换为电流控制模式。
3. 扭矩开关写"1"，即打开扭矩。
4. 设定目标电流，即ID1舵机会以设定的方式运动。

**实现步骤：**
1. 将ID1舵机的扭矩开关状态修改为关闭。
2. 将ID1舵机的控制模式修改为电流控制模式。
3. 将ID1舵机的目标电流修改为100mA。
4. 将ID1舵机的扭矩开关状态修改为打开。
------------------------------------------------------------------------------
